<!DOCTYPE html>
<html lang="fr">
<head>
  
    <title>Documentation projet final :: Blog - Amine Babouri</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Documentation projet final" />
<meta name="keywords" content=", " />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.aminebabouri.online/fr/posts-fr/documentation/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://blog.aminebabouri.online/styles.css">







  <link rel="shortcut icon" href="https://blog.aminebabouri.online/img/theme-colors/green.png">
  <link rel="apple-touch-icon" href="https://blog.aminebabouri.online/img/theme-colors/green.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="fr" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Documentation projet final">
<meta property="og:description" content="Documentation projet final" />
<meta property="og:url" content="https://blog.aminebabouri.online/fr/posts-fr/documentation/" />
<meta property="og:site_name" content="Blog - Amine Babouri" />

  
  
  <meta property="og:image" content="https://blog.aminebabouri.online/">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2023-07-24 14:59:09 &#43;0200 CEST" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    amine@blog-fr:~/$
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/cv-fr">./cv</a></li>
        
      
        
          <li><a href="/posts-fr">./posts-fr</a></li>
        
      
        
          <li><a href="/tags">./tags</a></li>
        
      
      
        <hr />
        
          <li>
            <a href="https://blog.aminebabouri.online/fr/">Fran√ßais</a>
          </li>
        
          <li>
            <a href="https://blog.aminebabouri.online/">English</a>
          </li>
        
      
    </ul>
  </li>
</ul>

    
    
      <ul class="menu menu--desktop menu--language-selector">
  <li class="menu__trigger">Fran√ßais&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        <li><a href="https://blog.aminebabouri.online/fr/">Fran√ßais</a></li>
      
        <li><a href="https://blog.aminebabouri.online/">English</a></li>
      
    </ul>
  </li>
</ul>

    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/cv-fr" >./cv</a></li>
        
      
        
          <li><a href="/posts-fr" >./posts-fr</a></li>
        
      
        
          <li><a href="/tags" >./tags</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.aminebabouri.online/fr/posts-fr/documentation/">Documentation projet final</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2023-07-24 ::
        
      </time>
    
    
      <span class="post-author">Amine</span>
    
    
  </div>

  
    <span class="post-tags">
      
      #<a href="https://blog.aminebabouri.online/fr/tags/azure/">Azure</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/azure-devops/">Azure Devops</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/prometheus/">Prometheus</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/grafana/">Grafana</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/monitoring/">Monitoring</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/supervision/">Supervision</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/devops/">Devops</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/wordpress/">Wordpress</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/terraform/">Terraform</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/powershell/">Powershell</a>&nbsp;
      
      #<a href="https://blog.aminebabouri.online/fr/tags/kubernetes/">Kubernetes</a>&nbsp;
      
    </span>
  
  


  
  
  <div class="post-content"><div>
        <hr>
<h1 id="documentation-technique--d√©ploiement-de-wordpress-sur-azure-kubernetes-service-aks-avec-terraform-azure-devops-et-supervision-avec-grafana-">Documentation Technique : D√©ploiement de WordPress sur Azure Kubernetes Service (AKS) avec Terraform, Azure DevOps et supervision avec Grafana üöÄüõ†Ô∏èüìä<a href="#documentation-technique--d√©ploiement-de-wordpress-sur-azure-kubernetes-service-aks-avec-terraform-azure-devops-et-supervision-avec-grafana-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="-sommaire">üìñ Sommaire<a href="#-sommaire" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ol>
<li>
<p>‚û°Ô∏è <a href="#introduction">Introduction</a></p>
<ol>
<li><a href="#11-pr%C3%A9sentation">Pr√©sentation</a></li>
<li><a href="#12-objectifs-">Objectifs</a></li>
<li><a href="#13-architecture-">Architecture</a></li>
<li><a href="#14-pr%C3%A9requis">Pr√©requis</a></li>
</ol>
</li>
<li>
<p>‚û°Ô∏è <a href="#2-d%C3%A9ploiement-de-linfrastructure-avec-terraform-">D√©ploiement de l&rsquo;Infrastructure avec Terraform</a></p>
<ol>
<li><a href="#21-cr%C3%A9ation-du-script-terraform">Cr√©ation du script terraform</a></li>
<li><a href="#22-cr%C3%A9ation-de-la-pipeline-azure-devops-et-configuration-du-stage-infra">Cr√©ation de la pipeline Azure Devops et configuration du stage Infra</a></li>
</ol>
</li>
<li>
<p>‚û°Ô∏è <a href="#3-d%C3%A9ploiement-de-wordpress---environnement-dev-avec-ingress">D√©ploiement de WordPress - Environnement Dev avec Ingress</a></p>
<ol>
<li><a href="#31-cr%C3%A9ation-du-manifest-yaml-et-des-scripts-pour-lingress">Cr√©ation du manifest YAML et des scripts pour l&rsquo;ingress</a></li>
<li><a href="#configuration-du-stage-dev-pour-d%C3%A9ployer-wordpress">Configuration du stage Dev AKS</a></li>
</ol>
</li>
<li>
<p>‚û°Ô∏è <a href="#4-d%C3%A9ploiement-de-wordpress---environnement-prod">D√©ploiement de WordPress - Environnement Prod</a></p>
<ol>
<li><a href="#41-configuration-du-stage-pour-lenvironnement-prod">Configuration du stage pour l&rsquo;environnement prod</a></li>
<li><a href="#42-configuration-du-stage-prod-aks">Configuration du stage Prod aks</a></li>
</ol>
</li>
<li>
<p>‚û°Ô∏è <a href="#5-installation-de-plugins-sur-wordpress-avec-un-script">Installation de Plugins sur WordPress avec un script</a></p>
<ol>
<li><a href="#51-script-pluginsps1">Script plugins</a></li>
<li><a href="#52-configuration-du-stage-plugins">Installation des Plugins pour WordPress</a></li>
</ol>
</li>
<li>
<p>‚û°Ô∏è <a href="#6-surveillance-avec-grafana-et-alerte">Surveillance avec Grafana et Alerte</a></p>
<ol>
<li><a href="#61-configuration-du-dashboard-grafana">Configuration du Dashboard Grafana</a></li>
<li><a href="#61-configuration-du-dashboard-grafana">Configuration des Alertes Grafana</a></li>
<li><a href="#63-test-de-charge">Test de charge</a></li>
</ol>
</li>
<li>
<p>‚û°Ô∏è Conclusion üèÅ</p>
<ol>
<li><a href="#71-r%C3%A9sum%C3%A9-du-projet">R√©sum√© du Projet</a></li>
<li><a href="#72-points-cl%C3%A9s-du-projet-">Points cl√©s du projet</a></li>
<li><a href="#73-conclusion">Conclusion</a></li>
</ol>
</li>
</ol>
<hr>
<h1 id="introduction">Introduction<a href="#introduction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h4 id="11-pr√©sentation">1.1 Pr√©sentation<a href="#11-pr√©sentation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>J&rsquo;ai √©t√© charg√© de d√©ployer une application WordPress sur Azure Kubernetes Service (AKS) en utilisant Azure DevOps. L&rsquo;objectif est de cr√©er une infrastructure fonctionnelle, s√©curis√©e √† faible co√ªt et reproductible tout en automatisant le processus de d√©ploiement, ce qui permettra de faciliter le d√©ploiment, la gestion et les mises √† jour ult√©rieures.</li>
</ul>
<h4 id="12-objectifs-">1.2 Objectifs :<a href="#12-objectifs-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>
<p>Cr√©ation d&rsquo;une infrastructure Azure avec Terraform, comprenant un Virtual Network (VNet) avec deux subnets, un pour l&rsquo;AKS et un pour la base de donn√©es, un Azure Database for MySQL flexible server √† faible co√ªt pour notre wordpress et un Storage Account.</p>
</li>
<li>
<p>Automatisation du d√©ploiement de WordPress sur l&rsquo;AKS √† l&rsquo;aide d&rsquo;Azure DevOps, en configurant les ressources Kubernetes n√©cessaires telles que les d√©ploiements, les services, les secrets, etc.
Mise en place d&rsquo;un Ingress Controller pour permettre l&rsquo;acc√®s externe √† WordPress depuis le navigateur.</p>
</li>
</ul>
<h4 id="13-architecture-">1.3 Architecture :<a href="#13-architecture-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>Infra :</li>
</ul>
<p><img src="/images/infraprojet.svg" alt="sch√©ma de l&amp;rsquo;infra"></p>
<ul>
<li>D√©ploiement :</li>
</ul>
<p><img src="/images/archi-devops.svg" alt="sch√©ma de l&amp;rsquo;infra azure devops"></p>
<ul>
<li>Wordpress :</li>
</ul>
<p><img src="/images/archi-wordpress.svg" alt="sch√©ma de l&amp;rsquo;infra de l&amp;rsquo;appli"></p>
<h4 id="14-pr√©requis">1.4 Pr√©requis<a href="#14-pr√©requis" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Voici les pr√©requis et comp√©tences n√©cessaires pour suivre et comprendre cette documentation :</p>
<ul>
<li>
<p>Connaissances de base en Cloud Computing</p>
<ul>
<li>Comprendre les concepts de base du Cloud Computing, y compris les services cloud, les mod√®les de d√©ploiement (IaaS, PaaS, SaaS) et les avantages du cloud.</li>
</ul>
</li>
<li>
<p>Notions fondamentales de Kubernetes :</p>
<ul>
<li>Avoir une compr√©hension de base de Kubernetes en tant que syst√®me d&rsquo;orchestration de conteneurs. Comprendre les concepts de pods, de d√©ploiements, de services, etc.</li>
</ul>
</li>
<li>
<p>Compr√©hension des conteneurs Docker:</p>
<ul>
<li>Savoir ce qu&rsquo;est Docker et comment il permet de cr√©er, g√©rer et ex√©cuter des conteneurs d&rsquo;application de mani√®re portable.</li>
</ul>
</li>
<li>
<p>Terraform :</p>
<ul>
<li>Avoir des connaissances de base sur Terraform, un outil d&rsquo;infrastructure en tant que code (IaC) qui permet de d√©crire l&rsquo;infrastructure cloud en utilisant une syntaxe d√©clarative.</li>
</ul>
</li>
<li>
<p>Azure DevOps :</p>
<ul>
<li>Comprendre les principes fondamentaux de Azure DevOps et comment il est utilis√© pour automatiser la livraison de logiciels et les pipelines de d√©ploiement.</li>
</ul>
</li>
<li>
<p>Git :</p>
<ul>
<li>Avoir une connaissance de base de Git, un syst√®me de contr√¥le de version, et savoir comment cloner, pousser et extraire des r√©f√©rentiels Git.</li>
</ul>
</li>
<li>
<p>Helm :</p>
<ul>
<li>Comprendre les concepts de base de Helm, un gestionnaire de paquets pour Kubernetes, qui facilite le d√©ploiement et la gestion d&rsquo;applications Kubernetes.</li>
</ul>
</li>
<li>
<p>Prometheus et Grafana :</p>
<ul>
<li>Avoir une compr√©hension de base de Prometheus, un syst√®me de surveillance et d&rsquo;alerte open-source, et de Grafana, un outil d&rsquo;analyse et de visualisation des m√©triques.</li>
</ul>
</li>
<li>
<p>Scripting et automatisation :</p>
<ul>
<li>Avoir des comp√©tences de base en scripting, en particulier en PowerShell, car certains scripts sont utilis√©s pour la gestion de l&rsquo;AKS et des ressources Azure.</li>
</ul>
</li>
<li>
<p>R√©seaux et s√©curit√© :</p>
<ul>
<li>Avoir des connaissances de base sur les r√©seaux et la s√©curit√© cloud, y compris les groupes de s√©curit√© r√©seau, les pare-feux et les r√®gles de routage.</li>
</ul>
</li>
<li>
<p>Gestion des ressources Azure :</p>
<ul>
<li>Comprendre comment cr√©er et g√©rer des ressources Azure telles que les comptes de stockage, les comptes Kubernetes (AKS), les comptes de conteneur, etc.</li>
</ul>
</li>
<li>
<p>D√©ploiement d&rsquo;applications Web:</p>
<ul>
<li>Avoir une connaissance de base des applications Web, des bases de donn√©es et des exigences pour d√©ployer des applications Web telles que WordPress.</li>
</ul>
</li>
</ul>
<hr>
<h1 id="2-d√©ploiement-de-linfrastructure-avec-terraform-">2. D√©ploiement de l‚ÄôInfrastructure avec Terraform üåç<a href="#2-d√©ploiement-de-linfrastructure-avec-terraform-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<hr>
<h4 id="21-cr√©ation-du-script-terraform">2.1 Cr√©ation du script Terraform<a href="#21-cr√©ation-du-script-terraform" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Avant de commencer, assurez-vous de poss√©der un compte Azure. Une fois cela fait, cr√©ez un Azure Repos Git o√π vous pourrez stocker tous vos pr√©cieux scripts et autres √©l√©ments n√©cessaires √† votre pipeline.</p>
<p>Une fois que votre Azure Repos Git est pr√™t √† l&rsquo;emploi, pr√©parez-vous √† construire une pipeline efficace. Tout d&rsquo;abord, cr√©ez un nouveau fichier que vous appellerez &ldquo;main.tf&rdquo;. C&rsquo;est dans ce fichier que tout se mettra en place.</p>
<p>Copiez et collez le script suivant dans votre fichier &ldquo;main.tf&rdquo; :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">terraform {
  required_providers {
    azurerm = {
      source  = &#34;hashicorp/azurerm&#34;
      version = &#34;3.57.0&#34;
    }
  }
}

provider &#34;azurerm&#34; {
  features {}
  tenant_id       = &#34;&#34; # peut √™tre obtenue en faisant un $ az account show
  subscription_id = &#34;&#34; # peut √™tre obtenue en faisant un $ az account show
}

data &#34;azurerm_resource_group&#34; &#34;rg&#34; {
  name = &#34;PERSO_AMINE&#34;
}

output &#34;id&#34; {
  value = data.azurerm_resource_group.rg.id
}

# Cr√©ation du r√©seau virtuel (VNet)
resource &#34;azurerm_virtual_network&#34; &#34;myVnet&#34; {
  name                = &#34;Vnet-wp&#34;
  address_space       = [&#34;10.0.0.0/8&#34;]
  resource_group_name = &#34;PERSO_AMINE&#34;
  location            = &#34;westeurope&#34;
}

# Cr√©ation du sous-r√©seau dans le VNet
resource &#34;azurerm_subnet&#34; &#34;myAKSSubnet&#34; {
  name                 = &#34;subnetaks&#34;
  resource_group_name  = &#34;PERSO_AMINE&#34;
  virtual_network_name = azurerm_virtual_network.myVnet.name
  address_prefixes     = [&#34;10.240.0.0/16&#34;]
}

# Cr√©ation du cluster AKS (Azure Kubernetes Service)
resource &#34;azurerm_kubernetes_cluster&#34; &#34;aks01&#34; {
  name                = &#34;aks-01&#34;
  location            = &#34;westeurope&#34;
  resource_group_name = &#34;PERSO_AMINE&#34;
  dns_prefix          = &#34;aks01-dns&#34;

  default_node_pool {
    name       = &#34;default&#34;
    node_count = 1
    vm_size    = &#34;Standard_DS2_v2&#34;
    vnet_subnet_id        = azurerm_subnet.myAKSSubnet.id
    
  }

  identity {
    type = &#34;SystemAssigned&#34;
  }

  depends_on = [azurerm_subnet.myAKSSubnet]
}


# Cr√©ation du sous-r√©seau pour MySQL
resource &#34;azurerm_subnet&#34; &#34;mysqlSubnet&#34; {
  name                 = &#34;subnetmysql&#34;
  resource_group_name  = &#34;PERSO_AMINE&#34;
  virtual_network_name = azurerm_virtual_network.myVnet.name
  address_prefixes     = [&#34;10.255.0.0/24&#34;]

  delegation {
    name = &#34;flexibleServerDelegation&#34;
    service_delegation {
      name    = &#34;Microsoft.DBforMySQL/flexibleServers&#34;
      actions = [&#34;Microsoft.Network/virtualNetworks/subnets/action&#34;]
    }
  }  
}

# Cr√©ation du sous-r√©seau pour le compte de stockage
resource &#34;azurerm_subnet&#34; &#34;storageSubnet&#34; {
  name                 = &#34;storage-subnet&#34;
  resource_group_name  = &#34;PERSO_AMINE&#34;
  virtual_network_name = azurerm_virtual_network.myVnet.name
  address_prefixes     = [&#34;10.250.0.0/24&#34;]
}

# Encodage en base64 des identifiants de la BDD
locals {
  admin_username = base64decode(&#34;encoder votre user&#34;)
  admin_password = base64decode(&#34;encoder votre password&#34;)
}

# Cr√©ation du serveur MySQL flexible
resource &#34;azurerm_mysql_flexible_server&#34; &#34;mysqlServer&#34; {
  name                = &#34;wordpress-aks01&#34;
  location            = &#34;westeurope&#34;
  resource_group_name = &#34;PERSO_AMINE&#34;
  sku_name            = &#34;B_Standard_B1s&#34;
  backup_retention_days     = 3       
  version                      = &#34;8.0.21&#34;
  delegated_subnet_id          = azurerm_subnet.mysqlSubnet.id
  administrator_login       =  local.admin_username
  administrator_password    = local.admin_password
}

# Cr√©ation de la database
resource &#34;azurerm_mysql_flexible_database&#34; &#34;database&#34; {
  name                = &#34;wordpress-db&#34;
  resource_group_name = data.azurerm_resource_group.rg.name
  server_name         = azurerm_mysql_flexible_server.mysqlServer.name
  charset             = &#34;utf8mb4&#34;
  collation           = &#34;utf8mb4_unicode_ci&#34;
}

# Cr√©ation du compte de stockage 
resource &#34;azurerm_storage_account&#34; &#34;storage&#34; {
  name                     = &#34;storagewpamine&#34;
  resource_group_name      = data.azurerm_resource_group.rg.name
  location                 = data.azurerm_resource_group.rg.location
  account_tier             = &#34;Standard&#34;
  account_replication_type = &#34;GRS&#34;
}

# Cr√©ation du compte du conteneur (dans le compte de stockage)
resource &#34;azurerm_storage_container&#34; &#34;container&#34; {
  name                  = &#34;containerwp&#34;
  storage_account_name  = azurerm_storage_account.storage.name
  container_access_type = &#34;container&#34;
}
</code></pre><h4 id="22-cr√©ation-de-la-pipeline-azure-devops-et-configuration-du-stage-infra">2.2 Cr√©ation de la pipeline Azure Devops et configuration du stage Infra<a href="#22-cr√©ation-de-la-pipeline-azure-devops-et-configuration-du-stage-infra" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>ne fois que vous avez pr√©par√© votre code Terraform, il est temps de cr√©er un pipeline dans Azure DevOps pour automatiser le d√©ploiement de l&rsquo;infrastructure.</p>
<ul>
<li>
<p>√âtape 1 : Acc√©dez √† Azure DevOps et s√©lectionnez votre projet.</p>
</li>
<li>
<p>√âtape 2 : Dans votre projet, cliquez sur l&rsquo;onglet &ldquo;Pipelines&rdquo; dans le menu sup√©rieur, puis cliquez sur &ldquo;Create Pipeline&rdquo;.</p>
</li>
<li>
<p>√âtape 3 : Choisissez votre r√©f√©rentiel (repository) source contenant vos fichiers Terraform, par exemple, Azure Repos Git ou GitHub, et connectez-le √† votre projet.</p>
</li>
</ul>
<p>Voici un exemple pour cr√©er une pipeline ansi que le stage &ldquo;infra&rdquo; avec les t√¢ches Terraform :</p>
<p><img src="/images/create_pipeline.png" alt="Sch√©ma"></p>
<p><img src="/images/create_pipeline2.png" alt="Sch√©ma"></p>
<p>Vous allez ensuite ajouter un agent et rechercher &ldquo;Terraform&rdquo;</p>
<p><img src="/images/create_pipeline3.png" alt="Sch√©ma"></p>
<p>Vous allez s√©l√©ctionner la commande correspodante, dans notre cas ce sera &ldquo;Terraform init&rdquo;. R√©p√©tez cette t√¢che pour &ldquo;Terraform Plan&rdquo; ainsi que &ldquo;Terraform Apply&rdquo;.
N&quot;oubliez pas de s√©l√©ctionner votre Azure Repos Git dans &ldquo;Configuration Directory&rdquo;.</p>
<p><img src="/images/create_tasks.png" alt="Sch√©ma"></p>
<hr>
<h1 id="3-d√©ploiement-de-wordpress---environnement-dev-avec-ingress">3. D√©ploiement de WordPress - Environnement Dev avec Ingress<a href="#3-d√©ploiement-de-wordpress---environnement-dev-avec-ingress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h4 id="31-cr√©ation-du-manifest-yaml-et-des-scripts-pour-lingress">3.1 Cr√©ation du manifest YAML et des scripts pour l‚Äôingress<a href="#31-cr√©ation-du-manifest-yaml-et-des-scripts-pour-lingress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Pour d√©ployer WordPress sur AKS, vous devrez cr√©er un fichier YAML manifeste Kubernetes d√©crivant l&rsquo;√©tat souhait√© de votre d√©ploiement WordPress.</p>
<p>De plus, vous aurez besoin de scripts pour g√©rer le d√©ploiement et la configuration de ressources telles que le contr√¥leur Ingress et les certificats SSL.</p>
<ul>
<li>√âtape 1 :
<ul>
<li>Cr√©er un fichier YAML</li>
<li>Cr√©ez un nouveau fichier texte √† l&rsquo;aide d&rsquo;un √©diteur de texte (par exemple, Notepad++ ou Visual Studio Code) et collez le contenu suivant dans le fichier :</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">apiVersion: apps/v1
kind: Deployment
metadata:
  name: wordpress-dev
spec:
  replicas: 1
  selector:
    matchLabels:
      app: wordpress-dev
  template:
    metadata:
      labels:
        app: wordpress-dev
        environment: dev
    spec:
      containers:
      - name: wordpress-dev
        image: wordpress:latest
        resources:
          limits:
            cpu: &#34;2&#34;
            memory: &#34;4Gi&#34;
          requests:
            cpu: &#34;1&#34;
            memory: &#34;2048Mi&#34;
        env:
        - name: WORDPRESS_DB_HOST
          value: &#34;&#34;
        - name: WORDPRESS_DB_USER
          valueFrom: 
            secretKeyRef:
              name: bdd-secret
              key: user
        - name: WORDPRESS_DB_PASSWORD
          valueFrom: 
            secretKeyRef:
              name: bdd-secret
              key: password
        - name: WORDPRESS_DB_NAME
          value: &#34;&#34;
        - name: WORDPRESS_DATABASE_PORT_NUMBER
          value: &#34;&#34;
        - name: WORDPRESS_CONFIG_EXTRA
          value: |
            define(&#39;DB_SSL&#39;, true);
            define(&#39;MYSQL_CLIENT_FLAGS&#39;, MYSQLI_CLIENT_SSL);
        ports:
        - containerPort: 80
          name: http
        - containerPort: 443
          name: https
        volumeMounts:
        - name: wordpress-storage
          mountPath: /var/www/html/wp-content
      volumes:
      - name: wordpress-storage
        persistentVolumeClaim:
          claimName: wordpress-pvc

---
apiVersion: v1
kind: Service
metadata:
  name: wordpress-svc
spec:
  ports:
  - name: http
    protocol: TCP
    port: 80
    targetPort: 80
  - name: https
    protocol: TCP
    port: 443
    targetPort: 443
  selector:
    app: wordpress-dev

---
apiVersion: v1
kind: Secret
metadata:
  name: bdd-secret
type: Opaque
data:
  user: &lt;entrer un user encoder en base64&gt;
  password: &lt;entrer un password encoder en base64&gt;

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: wordpress-pvc
spec:
  accessModes:
    - ReadWriteOnce¬≤
  resources:
    requests:
      storage: 5Gi
</code></pre><p>Dans ce fichier YAML, vous pouvez personnaliser les param√®tres de votre d√©ploiement WordPress, tels que le nombre de r√©pliques, les limites de ressources et les informations d&rsquo;identification de la base de donn√©es.</p>
<p>ssurez-vous de remplacer &lt;BASE64_ENCODED_DB_USER&gt; et &lt;BASE64_ENCODED_DB_PASSWORD&gt; par votre utilisateur et votre mot de passe de base de donn√©es encod√©s en Base64.</p>
<ul>
<li>
<p>√âtape 2 : Enregistrez le fichier YAML</p>
<ul>
<li>Enregistrez le fichier en lui donnant un nom significatif tel que &ldquo;wordpress-deployment.yaml&rdquo;. Assurez-vous qu&rsquo;il se trouve dans votre Azure Repos Git.</li>
</ul>
</li>
<li>
<p>√âtape 3 : Ajoutez un nouveau stage pour le d√©ploiement avec les tasks suivantes :</p>
</li>
</ul>
<p><img src="/images/create_tasks_kube.png" alt="Sch√©ma"></p>
<p>Pour d√©ployer un contr√¥leur Ingress et g√©rer les certificats SSL, vous pouvez cr√©er des scripts PowerShell qui interagiront avec votre cluster Kubernetes √† l&rsquo;aide de l&rsquo;outil de ligne de commande kubectl. Voici des exemples de scripts PowerShell :</p>
<p>Vous allez cr√©er un script appel√© &ldquo;helm-repo&rdquo;, c&rsquo;est un script powershell qui va d√©ployer le g√©n√©rateur de certificat, l&rsquo;ingress et pleins d&rsquo;autres choses utiles.
Vous allez y coller ceci :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid"># Connexion au cluster
az account set --subscription &#34;ins√©rer la subscription de son abonnement azure&#34;
az aks get-credentials --resource-group &#34;ins√©rer le nom de votre groupe de ressource&#34; --name &#34;ins√©rer le nom de votre cluster&#34;

# Ajout du repo pour l&#39;ingress
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo add jetstack https://charts.jetstack.io
helm repo update

# Ajout des repo suivants : grafana, promtheus, loki

helm repo add grafana https://grafana.github.io/helm-charts
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

# Deploiement de l&#39;ingress, du g√©n√©rateur de certificat, de loki, de grafana et prometheus
helm install quickstart ingress-nginx/ingress-nginx 
helm install my-cert-manager jetstack/cert-manager --create-namespace --version v1.12.0 --set installCRDs=true
helm install loki grafana/loki-stack --create-namespace --set grafana.enabled=true
helm install prometheus prometheus-community/prometheus


# Param√®tre obligatoire pour r√©soudre le probl√®me du cluster li√© √† l&#39;ingress
helm upgrade --set controller.service.externalTrafficPolicy=Local quickstart ingress-nginx/ingress-nginx
</code></pre><p>Le script powershell &ldquo;ingress.ps1&rdquo; :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid"># Connexion au cluster
az account set --subscription &#34;ins√©rer la subscription de son abonnement azure&#34;
az aks get-credentials --resource-group &#34;ins√©rer le nom de votre groupe de ressource&#34; --name &#34;ins√©rer le nom de votre cluster&#34;

# Commande qui stock dans une variable l&#39;adresse ip de l&#39;ingress
$service = kubectl get service quickstart-ingress-nginx-controller -o json | ConvertFrom-Json
$externalIP = $service.status.loadBalancer.ingress[0].ip
Write-Output $externalIP

$yaml = @&#34;
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kuard
  annotations:
    #cert-manager.io/issuer: &#34;letsencrypt-staging&#34;
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - $externalIP.sslip.io
    secretName: quickstart-example-tls
  rules:
  - host: $externalIP.sslip.io
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: wordpress-svc
            port:
              number: 80
&#34;@

# Enregistrement du contenu YAML dans un fichier temporaire
$yamlFilePath = &#34;$env:TEMP\kuard-ingress.yaml&#34;
$yaml | Set-Content -Path $yamlFilePath -Encoding UTF8
</code></pre><p>Le manifest issuer-stagging.yaml est √©metteur d√©finit comment cert-manager demandera des certificats  :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: letsencrypt-staging
spec:
  acme:
    # The ACME server URL
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    # Email address used for ACME registration
    email: fd@gmail.com
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-staging
    # Enable the HTTP-01 challenge provider
    solvers:
      - http01:
          ingress:
            ingressClassName: nginx
</code></pre><p>Remarque : Ces scripts supposent que vous avez d√©j√† configur√© votre cluster AKS et que vous disposez des autorisations n√©cessaires pour interagir avec lui √† l&rsquo;aide de kubectl.</p>
<p>L&rsquo;√©metteur de production, issuer-production.yaml :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # The ACME server URL
    server: https://acme-v02.api.letsencrypt.org/directory
    # Email address used for ACME registration
    email: fd@gmail.com
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-prod
    # Enable the HTTP-01 challenge provider
    solvers:
      - http01:
          ingress:
            ingressClassName: nginx
</code></pre><p>Puis pour finir le script powershell de l&rsquo;ingress final :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid"># Connexion au cluster
az account set --subscription &#34;ins√©rer la subscription de son abonnement azure&#34;
az aks get-credentials --resource-group &#34;ins√©rer le nom de votre groupe de ressource&#34; --name &#34;ins√©rer le nom de votre cluster&#34;

$service = kubectl get service quickstart-ingress-nginx-controller -o json | ConvertFrom-Json
$externalIP = $service.status.loadBalancer.ingress[0].ip
Write-Output $externalIP

$yaml = @&#34;
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kuard
  annotations:
    cert-manager.io/issuer: &#34;letsencrypt-staging&#34;
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - $externalIP.sslip.io
    secretName: quickstart-example-tls
  rules:
  - host: $externalIP.sslip.io
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: wordpress-svc
            port:
              number: 80
&#34;@

# Enregistrement du contenu YAML dans un fichier temporaire
$yamlFilePath = &#34;$env:TEMP\kuard-ingress.yaml&#34;
$yaml | Set-Content -Path $yamlFilePath -Encoding UTF8

$service = kubectl get service quickstart-ingress-nginx-controller -o json | ConvertFrom-Json
$externalIP = $service.status.loadBalancer.ingress[0].ip
Write-Output $externalIP

$yamltest = @&#34;
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: test
  annotations:
    cert-manager.io/issuer: &#34;letsencrypt-prod&#34;
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - $externalIP.sslip.io
    secretName: quickstart-example-tls
  rules:
  - host: $externalIP.sslip.io
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: wordpress-svc
            port:
              number: 80
&#34;@

# Enregistrement du contenu YAML dans un fichier temporaire
$yamltestFilePath = &#34;$env:TEMP\test-ingress.yaml&#34;
$yamltest | Set-Content -Path $yamltestFilePath -Encoding UTF8

# Cr√©ation de l&#39;Ingress avec le fichier YAML
kubectl apply -f $yamltestFilePath
</code></pre><h4 id="configuration-du-stage-dev-pour-d√©ployer-wordpress">Configuration du stage Dev pour d√©ployer wordpress<a href="#configuration-du-stage-dev-pour-d√©ployer-wordpress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Maintenant que vous avez pr√©par√© le fichier et les scripts YAML n√©cessaires, il est temps de configurer l&rsquo;√©tape de d√©veloppement de votre pipeline de d√©ploiement AKS dans Azure DevOps</p>
<p>Ajoutez un nouveau stage puis cliquez dessus et ajouter des tasks</p>
<p>Install Kubectl :</p>
<ul>
<li><img src="/images/create_stage_dev.png" alt=""></li>
</ul>
<p>D√©ploie le manifest YAML wordpress-dev.yaml</p>
<ul>
<li><img src="/images/create_stage_dev2.png" alt=""></li>
</ul>
<p>Ex√©cute le script helm-repo.ps1</p>
<ul>
<li><img src="/images/create_stage_dev3.png" alt=""></li>
</ul>
<p>Ex√©cute le script ingress.ps1</p>
<ul>
<li><img src="/images/create_stage_dev4.png" alt=""></li>
</ul>
<p>D√©ploie le manifest issuer-staging.yaml</p>
<ul>
<li><img src="/images/create_stage_dev5.png" alt=""></li>
</ul>
<p>D√©ploie le manifest issuer-prod.yaml</p>
<ul>
<li><img src="/images/create_stage_dev6.png" alt=""></li>
</ul>
<p>Ex√©cute le script ingress-edited.ps1</p>
<ul>
<li><img src="/images/create_stage_dev7.png" alt=""></li>
</ul>
<hr>
<h1 id="4-d√©ploiement-de-wordpress---environnement-prod">4. D√©ploiement de WordPress - Environnement Prod<a href="#4-d√©ploiement-de-wordpress---environnement-prod" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h4 id="41-configuration-du-stage-pour-lenvironnement-prod">4.1 Configuration du stage pour l‚Äôenvironnement prod<a href="#41-configuration-du-stage-pour-lenvironnement-prod" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>√âtape 1 :
<ul>
<li>Cr√©er un fichier YAML</li>
<li>Cr√©ez un nouveau fichier texte √† l&rsquo;aide d&rsquo;un √©diteur de texte (par exemple, Notepad++ ou Visual Studio Code) nommez le &ldquo;wordpress-dev.yaml&rdquo; et collez le contenu suivant dans le fichier :</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wordpress-prod
spec:
  replicas: 1
  selector:
    matchLabels:
      app: wordpress-prod
  template:
    metadata:
      labels:
        app: wordpress-prod
        environment: prod        
    spec:
      containers:
      - name: wordpress-prod
        image: wordpress:latest
        resources:
          limits:
            cpu: &#34;2&#34;
            memory: &#34;4Gi&#34;
          requests:
            cpu: &#34;1&#34;
            memory: &#34;1024&#34;
        env:
        - name: WORDPRESS_DB_HOST
          value: wordpress-aks01.mysql.database.azure.com
        - name: WORDPRESS_DB_USER
          valueFrom: 
            secretKeyRef:
              name: bdd-secret
              key: user
        - name: WORDPRESS_DB_PASSWORD
          valueFrom: 
            secretKeyRef:
              name: bdd-secret
              key: password
        - name: WORDPRESS_DB_NAME
          value: wordpress-db
        - name: WORDPRESS_DATABASE_PORT_NUMBER
          value: &#34;3306&#34;
        - name: WORDPRESS_CONFIG_EXTRA
          value: |
            define(&#39;DB_SSL&#39;, true);
            define(&#39;MYSQL_CLIENT_FLAGS&#39;, MYSQLI_CLIENT_SSL);
        ports:
        - containerPort: 80
          name: http
        - containerPort: 443
          name: https
        volumeMounts:
        - name: wordpress-storage
          mountPath: /var/www/html/wp-content
      volumes:
      - name: wordpress-storage
        persistentVolumeClaim:
          claimName: wordpress-pvc

---
apiVersion: v1
kind: Service
metadata:
  name: wordpress-svc
spec:
  ports:
  - name: http
    protocol: TCP
    port: 80
    targetPort: 80
  - name: https
    protocol: TCP
    port: 443
    targetPort: 443
  selector:
    app: wordpress-prod

---
apiVersion: v1
kind: Secret
metadata:
  name: bdd-secret
type: Opaque
data:
  user: YW1pbmU=
  password: SG9tZWxhbmRlcjM3JSo=

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: wordpress-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: wordpress-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: wordpress-prod
  minReplicas: 1
  maxReplicas: 2
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 80
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 90
</code></pre><h4 id="42-configuration-du-stage-prod-aks">4.2 Configuration du stage Prod AKS<a href="#42-configuration-du-stage-prod-aks" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Ajoutez un nouveau stage puis cliquez dessus et ajouter des tasks</p>
<p>Install kubectl</p>
<ul>
<li><img src="/images/create_stage_prod.png" alt=""></li>
</ul>
<p>Supprime le deploiement wordpress-dev</p>
<ul>
<li><img src="/images/create_stage_prod2.png" alt=""></li>
</ul>
<p>D√©ploie le manifest wordpress-prod</p>
<ul>
<li><img src="/images/create_stage_prod3.png" alt=""></li>
</ul>
<h1 id="5-installation-de-plugins-sur-wordpress-avec-un-script">5. Installation de Plugins sur WordPress avec un script<a href="#5-installation-de-plugins-sur-wordpress-avec-un-script" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h4 id="51-script-pluginsps1">5.1 Script plugins.ps1<a href="#51-script-pluginsps1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Voici le script :</p>
<p>Avant de proc√©der √† l&rsquo;installation des plugins WordPress, nous avons besoin d&rsquo;un script PowerShell pour automatiser le processus d&rsquo;installation.</p>
<p>Cr√©ez un nouveau script PowerShell nomm√© plugins.ps1 et ajoutez le contenu suivant :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid"># Connexion au cluster 
az account set --subscription &#34;ins√©rer la subscription de son abonnement azure&#34;
az aks get-credentials --resource-group &#34;ins√©rer le nom de votre groupe de ressource&#34;

# Commandes pour stocker dans des variables les choses suivantes : nom du conteneur de mon storage account, cl√© du compte storage
$key_storage = az storage account keys list --account-name storagewpamine --resource-group PERSO_AMINE --query &#34;[0].value&#34; --output tsv
Write-Host $key_storage

# Commandes qui stock dans des variables les choses suivantes : nom du pod, et l&#39;adresse de l&#39;ingress 
$podName = kubectl get po -o custom-columns=&#34;:metadata.name&#34; --no-headers | Select-Object -Index 12
$result = kubectl get ingress -o json | ConvertFrom-Json
$address = $result.items[0].status.loadBalancer.ingress[0].ip

# Commandes qui install le th√®mes et les plugins n√©cessaire √† mon site wordpress 
$commands = @(
    &#34;curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar&#34;,
    &#34;chmod +x wp-cli.phar&#34;,
    &#34;mv wp-cli.phar /usr/local/bin/wp&#34;,
    &#34;cd ..&#34;,
    &#34;chmod 777 -R html/&#34;,
    &#34;cd html&#34;,
    &#34;wp core install --url=&#39;https://$($address).sslip.io/&#39; --title=&#39;&lt;ins√©rer le nom de votre site&#39; --admin_user=&#39;&lt;ins√©rer le nom d&#39;utilisateur de votre bdd&gt;&#39; --admin_password=&#39;&lt;ins√©rer le mot de passe de votre bdd&gt;&#39; --admin_email=&#39;&lt;ins√©rer l&#39;adresse mail que vous souhaitez pour wordpress&#39; --allow-root&#34;,
    &#34;wp theme install zakra --activate --allow-root&#34;,
    &#34;wp plugin install windows-azure-storage --activate --allow-root&#34;,
    &#34;wp option update azure_storage_account_name &#39;storagewpamine&#39; --allow-root&#34;,
    &#34;wp option update azure_storage_account_primary_access_key &#39;$key_storage&#39; --allow-root&#34;,
    &#34;wp option update default_azure_storage_account_container_name &#39;containerwp&#39; --allow-root&#34;,
    &#34;wp option update azure_storage_use_for_default_upload &#39;true&#39; --allow-root&#34;,
    &#34;wp plugin install elementor --activate --allow-root&#34;,
    &#34;wp plugin install themegrill-demo-importer --activate --allow-root&#34;,
    &#34;wp plugin install wp-booking-system --activate --allow-root&#34;,
    &#34;wp plugin install wp-fastest-cache --activate --allow-root&#34;
)

$commandsScript = $commands -join &#34;; &#34;

kubectl exec -it $podName -- bash -c $commandsScript
</code></pre><h4 id="52-configuration-du-stage-plugins">5.2 Configuration du stage plugins<a href="#52-configuration-du-stage-plugins" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Maintenant que nous avons le script PowerShell pour installer les plugins WordPress, configurons une nouvelle √©tape dans le pipeline Azure DevOps pour cette t√¢che</p>
<ul>
<li><img src="/images/create_stage_plugins.png" alt=""></li>
</ul>
<h1 id="6-surveillance-avec-grafana-et-alerte">6. Surveillance avec Grafana et Alerte<a href="#6-surveillance-avec-grafana-et-alerte" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h4 id="61-configuration-du-dashboard-grafana">6.1 Configuration du Dashboard Grafana<a href="#61-configuration-du-dashboard-grafana" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Pour acc√©der √† Grafana nous avons deux solution, soit faire un port-forward soit mettre le pod grafana en type LoadBalancer.
Nous allons voir la premi√®re solution mais si la deuxi√®me vous int√©resse vous pouvez vous rendre sur un autre de mes tutoriels, cliquez sur ce <a href="https://blog.aminebabouri.online/posts/prometheus_and_grafana/">lien</a>.</p>
<p>Bien, nous allons faire un port-forward (redirection de port) afin d&rsquo;acc√©der √† Grafana sans l&rsquo;exposer au r√©seau ext√©rieur. (vous devez √™tre connect√© √† votre aks)</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">kubectl port-forward svc/loki-grafana 75:80
</code></pre><p>Puis taper sur votre navigateur : localhost:75</p>
<p>Vous allez arriver sur la page de conenxion de Grafana, le nom d&rsquo;utilisateur par d√©faut de Grafana est admin, en revenche pour connaitre votre mot de passe vous devez taper cette commande car il sera encod√© en base64 :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">kubectl get secrets loki-grafana -o yaml
</code></pre><p>Vous verrez alors le champ &ldquo;admin-password: XXXXXXXXXXXXXXXXXXXXXXXX&rdquo;</p>
<p>Copier le password, rendez vous sur un terminal bash puis ex√©cuter cette commande :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">echo -n &#34;XXXXXXXXXXXXXXXXXXXXXXXX&#34; | base64 --decode
</code></pre><p>Vous serez alors connect√© √† votre Grafana.</p>
<p>Suivez ceci pour ajouter prometheus en datas source √† Grafana :</p>
<p><img src="/images/data_prometheus.png" alt="adddata"></p>
<p><img src="/images/add_ip.png" alt="addip"></p>
<p>Ensuite cr√©er un Dashboard puis configurez vous comme vous le voulez</p>
<p><img src="/images/result.png" alt="create_dashboard"></p>
<h4 id="62-configuration-des-alertes-grafana">6.2 Configuration des Alertes Grafana<a href="#62-configuration-des-alertes-grafana" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="/images/rule.png" alt="createrule">
<img src="/images/rule2.png" alt="createrule"></p>
<h4 id="63-test-de-charge">6.3 Test de charge<a href="#63-test-de-charge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Pour tester notre site nous allons faire un test de charge, cela permettra de savoir si il faut allouer plus de ressources √† notre AKS/Pod, mais cela nous permettra √©galement de voir si nos alertes fonctionnent bien.</p>
<p>Nous allons alors utiliser une commande linux :</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">ab -n 1000 -c 1000 -t 300 &lt;lien de votre site web&gt;
</code></pre><p>Cette commande simule 500 utilisateurs simultan√©s pendant 5 minutes.</p>
<p>Voyons voir si nos alertes fonctionnent :</p>
<p><img src="/images/rules_grafana.png" alt="resultat"></p>
<p><img src="/images/rules_grafana2.png" alt="resultat_alert"></p>
<hr>
<h4 id="71-r√©sum√©-du-projet">7.1 R√©sum√© du projet<a href="#71-r√©sum√©-du-projet" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Le projet vise √† d√©ployer avec succ√®s une instance de l&rsquo;application WordPress sur le service Azure Kubernetes (AKS) en utilisant divers outils tels que Terraform, Azure DevOps, Grafana et Prometheus. L&rsquo;utilisation d&rsquo;Azure Kubernetes Service permet de b√©n√©ficier d&rsquo;une orchestration √©volutive de conteneurs, tandis que Terraform facilite la gestion de l&rsquo;infrastructure en tant que code. L&rsquo;int√©gration d&rsquo;Azure DevOps assure une livraison continue et efficace, tandis que Grafana et Prometheus fournissent des m√©triques et des alertes pour surveiller les performances du cluster.</p>
<hr>
<h4 id="72-points-cl√©s-du-projet-">7.2 Points cl√©s du projet :<a href="#72-points-cl√©s-du-projet-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>
<p>Infrastructure en tant que Code (IaC) avec Terraform : Le projet met l&rsquo;accent sur la gestion de l&rsquo;infrastructure de mani√®re d√©clarative gr√¢ce √† Terraform. Les fichiers de configuration Terraform sont utilis√©s pour cr√©er et configurer les ressources Azure n√©cessaires, telles que les comptes de stockage, le cluster AKS, etc.</p>
</li>
<li>
<p>D√©ploiement d&rsquo;une application Web sur AKS : L&rsquo;objectif principal du projet est de d√©ployer l&rsquo;application Web WordPress sur le cluster AKS nouvellement cr√©√©. Cela implique de cr√©er des images de conteneurs Docker, de configurer des d√©ploiements Kubernetes, des services et des secrets pour h√©berger l&rsquo;application.</p>
</li>
<li>
<p>Int√©gration et Livraison Continue (CI/CD) : Azure DevOps est utilis√© pour cr√©er des pipelines d&rsquo;int√©gration et de livraison continue. Cela permet d&rsquo;automatiser le processus de d√©ploiement, de tester et de mettre √† jour l&rsquo;application de mani√®re coh√©rente et reproductible.</p>
</li>
<li>
<p>Surveillance avec Prometheus et Grafana : Le projet inclut la mise en place de Prometheus pour la collecte de m√©triques et de Grafana pour la visualisation de ces m√©triques. Cela permet aux op√©rateurs de surveiller les performances du cluster AKS et de d√©tecter rapidement les probl√®mes potentiels.</p>
</li>
<li>
<p>Scalabilit√© et Haute Disponibilit√© : Gr√¢ce √† l&rsquo;utilisation d&rsquo;Azure Kubernetes Service, le cluster peut √™tre facilement mis √† l&rsquo;√©chelle pour r√©pondre aux besoins croissants de l&rsquo;application. De plus, la r√©plication et la distribution des charges garantissent une haute disponibilit√© de l&rsquo;application.</p>
</li>
</ul>
<hr>
<h4 id="73-conclusion">7.3 Conclusion<a href="#73-conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Le d√©ploiement de WordPress sur Azure Kubernetes Service avec Terraform, Azure DevOps, Grafana et Prometheus offre une approche robuste et √©volutive pour h√©berger des applications Web modernes. L&rsquo;automatisation fournie par Azure DevOps facilite grandement la gestion du cycle de vie de l&rsquo;application, tandis que la surveillance avec Prometheus et Grafana garantit des performances optimales.</p>
<p>Le projet d√©montre l&rsquo;importance de l&rsquo;infrastructure en tant que code, o√π les ressources cloud sont g√©r√©es de mani√®re reproductible, tra√ßable et sans intervention manuelle. De plus, l&rsquo;utilisation de Kubernetes permet de simplifier le d√©ploiement et la gestion des conteneurs, offrant ainsi une flexibilit√© accrue pour les √©quipes de d√©veloppement et d&rsquo;exploitation.</p>
<p>En conclusion, ce projet constitue une base solide pour d√©ployer d&rsquo;autres applications sur Azure Kubernetes Service et offre des perspectives d&rsquo;am√©lioration continue en explorant davantage les fonctionnalit√©s avanc√©es d&rsquo;Azure et des outils de surveillance et de gestion connexes.</p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Lire les autres articles</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="https://blog.aminebabouri.online/fr/posts-fr/install_docker/">
                <span class="button__text">Comment installer Docker sur Ubuntu</span>
                <span class="button__icon">‚Üí</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-blog-aminebabouri-online" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<div id="disqus_thread"></div>
<script>
    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://https-blog-aminebabouri-online.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript"></a></noscript>
  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>¬© 2023 all rights reserved</a></span>
    
      <span>:: Amine Babouri</span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
